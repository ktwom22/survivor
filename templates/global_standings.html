{% extends "layout.html" %}
{% block content %}

<div class="text-center mb-5">
    <h1 class="display-4 fw-900 uppercase ls-2">World Standings</h1>
    <p class="text-accent fw-900 uppercase ls-1">Survivor 50 Global Tournament</p>
</div>

{% if my_tribe %}
<div class="pro-card border-accent mb-5 bg-black">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h4 class="fw-900 text-accent uppercase m-0 ls-1">Viewing: <span class="text-white">{{ display_name }}</span></h4>

            {% if session.username and display_name != session.username + "'s Tribe" %}
                <a href="{{ url_for('global_leaderboard') }}" class="btn btn-sm btn-outline-light fw-900 uppercase ls-1 mt-2" style="font-size: 0.7rem;">
                    ‚Üê Back to My Tribe
                </a>
            {% endif %}
        </div>

        {% if display_name == session.username + "'s Tribe" or display_name == "Your Global Entry" %}
            <a href="{{ url_for('global_draft_page') }}" class="btn btn-sm btn-accent fw-900 uppercase ls-1">Edit Draft</a>
        {% endif %}
    </div>

    <div class="row g-3 text-center">
        <div class="col-4">
            <span class="d-block text-white fw-900 x-small uppercase ls-1 mb-1">Captain (2x)</span>
            <div class="p-3 border border-white">
                <span class="text-accent fw-900 uppercase">{{ my_tribe.cap1.name if my_tribe.cap1 else 'EMPTY' }}</span>
            </div>
        </div>
        <div class="col-4">
            <span class="d-block text-white fw-900 x-small uppercase ls-1 mb-1">Lieutenant (1.5x)</span>
            <div class="p-3 border border-white">
                <span class="text-accent fw-900 uppercase">{{ my_tribe.cap2.name if my_tribe.cap2 else 'EMPTY' }}</span>
            </div>
        </div>
        <div class="col-4">
            <span class="d-block text-white fw-900 x-small uppercase ls-1 mb-1">Sergeant (1.25x)</span>
            <div class="p-3 border border-white">
                <span class="text-accent fw-900 uppercase">{{ my_tribe.cap3.name if my_tribe.cap3 else 'EMPTY' }}</span>
            </div>
        </div>
    </div>

    <div class="mt-4 pt-3 border-top border-white">
        <span class="text-white fw-900 x-small uppercase ls-1 d-block mb-3">Squad Members:</span>
        <div class="d-flex flex-wrap gap-2">
            {% for p in my_tribe.regs %}
                <span class="badge border border-white text-white fw-900 uppercase px-3 py-2 ls-1" style="background: rgba(255,255,255,0.1);">
                    {{ p.name }}
                </span>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}

<div class="pro-card border-white p-0 overflow-hidden bg-black">
    <table class="table table-dark table-hover m-0 h-contrast-table">
        <thead class="bg-black">
            <tr class="text-white fw-900 x-small uppercase ls-2">
                <th class="ps-4 py-3">Rank</th>
                <th class="py-3">Owner</th>
                <th class="text-end pe-4 py-3">Points</th>
            </tr>
        </thead>
        <tbody class="border-top-0">
            {% for p in full_global_leaderboard %}
            <tr class="align-middle {% if p.user == session.username %}bg-accent-soft border-y-accent{% endif %}">
                <td class="ps-4 fw-900 text-accent">#{{ loop.index }}</td>
                <td class="fw-900 uppercase ls-1">
                    <a href="{{ url_for('global_leaderboard', view_user=p.user) }}" class="text-white text-decoration-none border-bottom border-accent user-link">
                        {{ p.user }}
                    </a>
                    {% if p.user == session.username %}
                        <span class="ms-2 badge bg-accent text-dark">YOU</span>
                    {% endif %}
                </td>
                <td class="text-end pe-4 fw-900 fs-5 text-accent">{{ p.score }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<style>
    .bg-accent-soft { background: rgba(255, 204, 0, 0.2) !important; }
    .border-y-accent { border-top: 2px solid var(--accent) !important; border-bottom: 2px solid var(--accent) !important; }
    .border-accent { border: 2px solid var(--accent) !important; }

    /* Hover effect for usernames */
    .user-link:hover {
        color: var(--accent) !important;
        border-color: white !important;
    }

    .x-small { font-size: 0.75rem; }

    /* High Contrast Table Overrides */
    .h-contrast-table td {
        padding-top: 1.2rem;
        padding-bottom: 1.2rem;
        border-bottom: 1px solid #ffffff !important; /* Pure White separators */
        background-color: #000 !important;
    }

    .h-contrast-table thead th {
        border-bottom: 4px solid var(--accent) !important;
        background-color: #000 !important;
    }

    /* Removing transparency from badges/text */
    .text-white { opacity: 1 !important; }
</style>

{% endblock %}