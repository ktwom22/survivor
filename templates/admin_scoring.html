{% extends "layout.html" %}
{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-900 uppercase text-accent m-0">Admin Scoring Portal</h2>
        <form action="{{ url_for('admin_scoring') }}" method="POST">
            <input type="hidden" name="sync_all" value="1">
            <button type="submit" class="btn btn-outline-light btn-sm fw-900 uppercase ls-1">Sync Cast from Sheets</button>
        </form>
    </div>

    <div class="pro-card p-4 border-secondary">
        <form action="{{ url_for('admin_scoring') }}" method="POST">
            <div class="row mb-4 align-items-end">
                <div class="col-md-3">
                    <label class="x-small fw-900 uppercase text-white-50 mb-2">Episode / Week #</label>
                    <input type="number" name="week_num" class="form-control bg-black text-white border-secondary" value="1" required>
                </div>
                <div class="col-md-9 text-end">
                    <span class="x-small fw-900 uppercase text-white-50 me-3">Point Reference: </span>
                    {% for key, val in config.items() %}
                        <span class="badge bg-dark border border-secondary me-1" style="font-size: 0.6rem;">
                            {{ key|replace('_', ' ')|upper }}: {{ val }}
                        </span>
                    {% endfor %}
                </div>
            </div>

            <div class="table-responsive" style="max-height: 70vh; overflow-y: auto;">
                <table class="table table-dark table-hover align-middle shadow-sm">
                    <thead class="sticky-top bg-black" style="z-index: 5;">
                        <tr class="x-small fw-900 uppercase ls-1 border-bottom border-secondary">
                            <th class="sticky-col bg-black">Survivor</th>
                            <th class="text-center text-danger">Out?</th>
                            <th class="text-center">Surv</th>
                            <th class="text-center">Imm</th>
                            <th class="text-center">Rew</th>
                            <th class="text-center">Adv</th>
                            <th class="text-center">Mrg</th>
                            <th class="text-center">F5</th>
                            <th class="text-center">F3</th>
                            <th class="text-center text-accent">WIN</th>
                            <th class="text-center text-info">CRY</th>
                            <th class="text-center text-warning">PNL</th>
                            <th class="text-center text-danger">QUIT</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for s in survivors if not s.is_out %}
                        <tr class="border-bottom border-secondary-subtle">
                            <td class="sticky-col bg-black fw-bold text-white small">{{ s.name }}</td>
                            <td class="text-center"><input type="checkbox" name="voted_out_{{ s.id }}" class="form-check-input border-danger"></td>
                            <td class="text-center"><input type="checkbox" name="surv_{{ s.id }}" class="form-check-input" checked></td>
                            <td class="text-center"><input type="checkbox" name="imm_{{ s.id }}" class="form-check-input"></td>
                            <td class="text-center"><input type="checkbox" name="rew_{{ s.id }}" class="form-check-input"></td>
                            <td class="text-center"><input type="checkbox" name="adv_{{ s.id }}" class="form-check-input"></td>
                            <td class="text-center"><input type="checkbox" name="mrg_{{ s.id }}" class="form-check-input"></td>
                            <td class="text-center"><input type="checkbox" name="f5_{{ s.id }}" class="form-check-input"></td>
                            <td class="text-center"><input type="checkbox" name="f3_{{ s.id }}" class="form-check-input"></td>
                            <td class="text-center"><input type="checkbox" name="win_{{ s.id }}" class="form-check-input border-accent"></td>
                            <td class="text-center"><input type="checkbox" name="cry_{{ s.id }}" class="form-check-input border-info"></td>
                            <td class="text-center"><input type="checkbox" name="pnl_{{ s.id }}" class="form-check-input border-warning"></td>
                            <td class="text-center"><input type="checkbox" name="quit_{{ s.id }}" class="form-check-input border-danger"></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <div class="mt-4">
                <button type="submit" class="btn btn-accent w-100 fw-900 py-3 uppercase ls-2">Commit Weekly Scores ðŸ”’</button>
            </div>
        </form>
    </div>
</div>

<style>
    .sticky-col {
        position: sticky;
        left: 0;
        z-index: 2;
        border-right: 2px solid #333 !important;
        min-width: 140px;
    }
    .form-check-input {
        width: 1.25rem;
        height: 1.25rem;
        background-color: #111;
        border-color: #444;
        cursor: pointer;
    }
    .form-check-input:checked {
        background-color: var(--accent);
        border-color: var(--accent);
    }
    .form-check-input:focus {
        box-shadow: none;
        border-color: var(--accent);
    }
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #000; }
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--accent); }
</style>
{% endblock %}